<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Temp</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.js"></script>
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="./css/style.css" type="text/css"/>
</head>
<body>

        <nav class="navbar navbar-expand-lg navbar-light bg-light">

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                  <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                      <a class="nav-link" href="https://home-controller123456.herokuapp.com//home">Home<span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item active">
                      <a class="nav-link" href="https://home-controller123456.herokuapp.com//department">store<span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item active">
                      <a class="nav-link" href="https://home-controller12345.herokuapp.com/">Manage your devices<span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item active">
                      <a class="nav-link" href="https://home-controller123456.herokuapp.com//tutorial">Getting started<span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item active">
                      <a class="nav-link" href="https://home-controller123456.herokuapp.com//createDepartment">Create Department<span class="sr-only">(current)</span></a>
                    </li>
                  </ul>
                  <a class="nav-link" href="https://home-controller123456.herokuapp.com/register">register<span class="sr-only">(current)</span></a>
                  <a id="color" class="nav-link" href="/register">Login<span class="sr-only">(current)</span></a>
                   

                    <form onSubmit= {this.searchOnSubmit} class="form-inline my-2 my-lg-0">
                    <input onChange= {this.searchOnChange} class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" />
                    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                    </form>
                </div>
              </nav>
              <br>

<div class="opac container">

    <div id="myhouse" class="row d-flex justify-content-center">
        My House:
    </div>

    <br>

    <div class="opac jumbotron d-flex justify-content-center">
        <div id="width">
            <ol class="opac2 list-group">
                <li class="list-group-item font-weight-bold txt">
                    Bedroom Temperature:<div id="temp"></div>
                </li>
                <br>
                <li class="list-group-item font-weight-bold txt">
                    Living Room Lights:
                    <button id="mybtn">On</button>
                </li>
                <br>
                <li class="list-group-item font-weight-bold txt">
                    Room Fan:
                    <button id="mybtn2">On</button>
                </li>
            </ol>
        </div>
    </div>
</div>

</body>
<script type="text/javascript">

let bool1, bool2;
let update = {};

getTemp = function(){
    $.get("api/temp", function(req, res){

        let temp = parseInt(req[req.length - 1].Temp);

        if(temp >= 78){
            $("#temp").css("color", "red");
        }
        else if(temp > 68 && temp < 78){
            $("#temp").css("color", "green");
        }
        else if(temp <= 68){
            $("#temp").css("color", "rgb(0, 195, 202)");
        }

        $("#temp").html(temp + "&#8457");
    });
}

getTemp();
setInterval(getTemp, 1000);

$.get("/api/led/", function(req, res){
    
    let pos1 = req[0].position
    let pos2 = req[1].position

    update1 = {
        position: pos1
    }

    update2 = {
        position: pos2
    }

    if(pos1 === 1){
        bool1 = true

        $("#mybtn").css('background', 'green');
        $("#mybtn").text("On");
    }
    else if(pos1 === 0){

        bool1 = false

        $("#mybtn").css('background', 'red');
        $("#mybtn").text("Off");
        
    }

    if(pos2 === 1){
        bool2 = true

        $("#mybtn2").css('background', 'green');
        $("#mybtn2").text("On");
    }
    else if(pos2 === 0){

        bool2 = false

        $("#mybtn2").css('background', 'red');
        $("#mybtn2").text("Off");
    }


})


    function updateLed(id, led) {
    $.ajax("/api/led/" + id, {
      method: "PUT",
      data: led
    }).then(function(){

    });
  }


$("#mybtn").on('click', function(){

    if(bool1){

        bool1 = false

        $("#mybtn").css('background', 'red');
        $("#mybtn").text("Off");
        
        update.position = 0;

        updateLed(1, update);
    }
    else if(!bool1) {

        bool1 = true

        $("#mybtn").css('background', 'green');
        $("#mybtn").text("On");

        update.position = 1;

        updateLed(1, update);
    }
})
$("#mybtn2").on('click', function(){

if(bool2){

    bool2 = false

    $("#mybtn2").css('background', 'red');
    $("#mybtn2").text("Off");
    
    update.position = 0;

    updateLed(2, update);
}
else if(!bool2) {

    bool2 = true

    $("#mybtn2").css('background', 'green');
    $("#mybtn2").text("On");

    update.position = 1;

    updateLed(2, update);
}
})
</script>
</html>